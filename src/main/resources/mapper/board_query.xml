<?xml version="1.0" encoding="UTF-8"?>

<!-- sql -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.example.enjoytrip.board.dao.BoardDao">
    <!-- 여기서 특정양만큼의 게시글 보여주기, 닉네임 저장-->
    <select id= "boardList" resultType="com.example.enjoytrip.board.dto.BoardDto">
        select board_id, touristspot_id, board_title, board_content, account_nickname
                 from board
             order by board_id
                limit #{pageSize} offset #{pageNum}
    </select>

    <select id= "boardDetail" parameterType = "int" resultType = "com.example.enjoytrip.board.dto.BoardDto">
        select *
        from board
        where board_id = #{boardId}
    </select>

    <!-- insert 자체에서 닉네임 저장-->
    <insert id ="boardInsert" useGeneratedKeys="true"
            keyProperty="boardId" keyColumn="board_id"
            parameterType="com.example.enjoytrip.board.dto.BoardDto">
        insert into board (touristspot_id, board_title, board_content, account_id, account_nickname)
             values (#{touristspotId},#{boardTitle},#{boardContent},#{accountId},
                     (select account_nickname
                       from account
                      where account_id = #{accountId}
                      )
                 )
    </insert>

    <update id = "boardUpdate" parameterType="com.example.enjoytrip.board.dto.BoardDto">
        update board
            set board_id = #{boardId}
              , touristspot_id = #{touristspotId}
              , board_title = #{boardTitle}
              , board_content = #{boardContent}
              , account_nickname =
            (
                select account_nickname as account_nickname
                from account
                where account_id = #{accountId}
            )
        where board_id = #{boardId}
    </update>

    <delete id = "boardDelete" parameterType="Integer">
        delete from board where board_id = #{boardId}
    </delete>


    <select id = "boardRecommendList" parameterType="Integer">
        select board_id from like_board where account_id = #{accountId} order by board_id desc
    </select>
    <select id = "boardRecommendCount" parameterType="Integer">
        select count(account_id) from like_board where board_id = #{boardId}
    </select>
    <insert id = "boardRecommendInsert">
        insert into like_board (board_id, account_id)
        values (#{boardId}, #{accountId})
    </insert>
    <delete id = "boardRecommendDelete" parameterType="Integer">
        delete from like_board where board_id = #{boardId} and account_id = #{accountId}
    </delete>

</mapper>